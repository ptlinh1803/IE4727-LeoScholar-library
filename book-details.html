<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Detail Page</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="book-styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <a href="homepage-member.html">
        <img src="img/ui/leoscholar-logo-transparent.png" alt="Logo" />
      </a>

      <!-- Hamburger Menu Icon -->
      <span class="menu-toggle">&#9776;</span>

      <div class="nav-links">
        <a href="#" class="active-page">Home</a>
        <a href="#">Search</a>
        <a href="#">My Shelf</a>
        <a href="#">Contribute</a>
        <div class="dropdown">
          <a href="#" class="profile-link active-page">
            Profile
            <img src="img/ui/drop-down-icon.svg" alt="Arrow Down Icon" />
          </a>
          <div class="dropdown-content">
            <a href="#">Settings</a>
            <a href="#">Payment</a>
            <a href="#">Logout</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
      <!-- Left Side with Background -->
      <div class="left-side">
        <!-- Back Button -->
        <a href="#" class="back-button">&lt; Back</a>

        <!-- Book Cover positioned on the border of left and right sides -->
        <div class="book-cover">
          <img src="img/books/1.jpg" alt="Book Cover" />
        </div>
      </div>

      <!-- Right Side with Content -->
      <div class="right-side">
        <h1 class="big-blue-h1 book-title">
          Introduction to Mathematical Statistics
          <i class="heart-icon far fa-heart"></i>
        </h1>

        <div class="book-info-container">
          <!-- Part 1 -->
          <div class="part-one">
            <div class="info-column">
              <h4>Available Format</h4>
              <div>
                <img src="img/ui/check.png" alt="Available" /> Hard Copy
              </div>
              <div>
                <img src="img/ui/cross.png" alt="Not Available" /> E-book
              </div>
              <div>
                <img src="img/ui/check.png" alt="Available" /> Audio Book
              </div>
              <button
                class="loan-button"
                id="loanReserveButton"
                onclick="toggleForm()"
              >
                Loan/Reserve
              </button>
            </div>
            <div class="info-column">
              <h4>Available at</h4>
              <div><img src="img/ui/map.png" alt="Uni Icon" /> NTU</div>
              <div><img src="img/ui/map.png" alt="Uni Icon" /> NUS</div>
              <!-- <div><img src="img/ui/map.png" alt="Uni Icon" /> And more</div> -->
              <div>
                <img src="img/ui/map.png" alt="Uni Icon" />
                <a
                  id="tableToggleButton"
                  onclick="toggleTable(); return false;"
                >
                  More details
                </a>
              </div>
              <div class="button-group">
                <button
                  class="read-button"
                  onclick="openPDF('database/quant_job_interview_qa.pdf')"
                >
                  Read
                </button>
                <button
                  class="listen-button"
                  onclick="openPDF('database/pride_and_prejudice_01_austen.mp3')"
                >
                  Listen
                </button>
              </div>
            </div>
          </div>

          <!-- Part 2 -->
          <div class="part-two">
            <h3 class="part-two-heading">Book Details</h3>
            <div class="book-details-table">
              <div class="table-row">
                <div class="table-header">Author:</div>
                <div class="table-cell">
                  Robert V. Hogg, Joseph W. McKean, Allen T. Craig
                </div>
              </div>
              <div class="table-row">
                <div class="table-header">Publication Year:</div>
                <div class="table-cell">2020</div>
              </div>
              <div class="table-row">
                <div class="table-header">Category:</div>
                <div class="table-cell">Mathematics & Statistics</div>
              </div>
              <div class="table-row">
                <div class="table-header">ISBN-13:</div>
                <div class="table-cell">94850352394554</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Table to show availability -->
        <div class="availability-table">
          <table>
            <thead>
              <tr>
                <th>University</th>
                <th>Branch</th>
                <th>Address</th>
                <th>Available Copies</th>
                <th>Shelf</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>NTU</td>
                <td>Communication & Information Library</td>
                <td>NS3-03-01</td>
                <td>3</td>
                <td>OP F3-3</td>
              </tr>
              <tr>
                <td>NUS</td>
                <td>Central Library</td>
                <td>12 Kent Ridge Crescent</td>
                <td>1</td>
                <td>YZ F3-1</td>
              </tr>
              <tr>
                <td>SMU</td>
                <td>Duda Family Business Library</td>
                <td>6214 Bishop Boulevard</td>
                <td>2</td>
                <td>ST F2-4</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Form for Borrowing -->
        <form
          id="loanForm"
          class="form-container"
          onsubmit="submitForm(); return false;"
        >
          <h2>Fill in Details</h2>

          <div>
            <label for="from-date">From:</label>
            <input
              type="date"
              id="from-date"
              onchange="validateDates()"
              required
            />
          </div>

          <div>
            <label for="to-date">To:</label>
            <input
              type="date"
              id="to-date"
              onchange="validateDates()"
              required
            />
          </div>

          <div>
            <label for="branch">Choose a branch to borrow from:</label>
            <select id="branch" onchange="updateAvailability()" required>
              <option value="">Select branch</option>
              <option value="ntu">NTU</option>
              <option value="nus">NUS</option>
              <option value="smu">SMU</option>
            </select>
          </div>

          <div>
            <label for="available-copies">Available copies:</label>
            <span
              id="available-copies"
              style="
                display: block;
                padding: 7px;
                border: 1px solid #ccc;
                border-radius: 5px;
                background-color: #f9f9f9;
              "
            >
              <!-- You can set the default text here, for example: "N/A" -->
              N/A
            </span>
          </div>

          <!-- Conditional Message & Action Button -->
          <p id="availability-message" style="color: red"></p>
          <button type="submit" id="actionButton">Loan</button>
          <button type="reset" id="resetButton" onClick="resetForm()">
            Reset
          </button>
        </form>

        <!-- Book description -->
        <div class="description">
          <h2>Description</h2>
          <p id="description-text">
            For courses in mathematical statistics. Comprehensive coverage of
            mathematical statistics - with a proven approach Introduction to
            Mathematical Statistics by Hogg, McKean, and Craig enhances student
            comprehension and retention with numerous, illustrative examples and
            exercises. Classical statistical inference procedures in estimation
            and testing are explored extensively, and the textâ€™s flexible
            organization makes it ideal for a range of mathematical statistics
            courses. Substantial changes to the 8th Edition - many based on user
            feedback - help students appreciate the connection between
            statistical theory and statistical practice, while other changes
            enhance the development and discussion of the statistical theory
            presented.
          </p>
          <span id="see-more-description" class="show-more">See More</span>
        </div>

        <!--About the authors-->
        <div class="about-author">
          <h2>About the Author(s)</h2>
          <p id="author-description">
            Robert V. Hogg (deceased), Professor Emeritus of Statistics at the
            University of Iowa since 2001, received his B.A. in mathematics at
            the University of Illinois and his M.S. and Ph.D. degrees in
            mathematics, specializing in actuarial sciences and statistics, from
            the University of Iowa. Known for his gift of humor and his passion
            for teaching, Hogg had far-reaching influence in the field of
            statistics. Throughout his career, Hogg played a major role in
            defining statistics as a unique academic field, and he almost
            literally "wrote the book" on the subject. He wrote more than 70
            research articles and co-authored four books, including Introduction
            of Mathematical Statistics, 6th Edition with J. W. McKean and A.T.
            Craig; Applied Statistics for Engineers and Physical Scientists, 3rd
            Edition with J. Ledolter; and A Brief Course in Mathematical
            Statistics, 1st Edition with E.A. Tanis. His texts have become
            classroom standards used by hundreds of thousands of students. Among
            the many awards he received for distinction in teaching, Hogg was
            honored at the national level (the Mathematical Association of
            America Award for Distinguished Teaching), the state level (the
            Governor's Science Medal for Teaching), and the university level
            (Collegiate Teaching Award). His important contributions to
            statistical research have been acknowledged by his election to
            fellowship standing in the ASA and the Institute of Mathematical
            Statistics. Elliot Tanis, Professor Emeritus of Mathematics at Hope
            College, received his M.S. and Ph.D. degrees from the University of
            Iowa. Tanis is the co-author of A Brief Course in Mathematical
            Statistics, 1st Edition with R. Hogg and Probability and Statistics:
            Explorations with MAPLE, 2nd Edition with Z. Karian. He has authored
            over 30 publications on statistics and is a past chairman and
            governor of the Michigan MAA, which presented him with both its
            Distinguished Teaching and Distinguished Service Awards. He taught
            at Hope for 35 years and in 1989 received the HOPE Award (Hope's
            Outstanding Professor Educator) for his excellence in teaching. In
            addition to his academic interests, Dr. Tanis is also an avid tennis
            player and devoted Hope sports fan. Dale Zimmerman is the Robert V.
            Hogg Professor in the Department of Statistics and Actuarial Science
            at the University of Iowa.
          </p>
          <span id="see-more-author" class="show-more">See More</span>
        </div>

        <!-- Discover similar books -->
        <div class="similar-books">
          <h2>Discover similar books</h2>
          <div class="books-grid">
            <a href="" class="book-wrapper">
              <img
                src="img/books/1.jpg"
                alt="Introduction to Mathematical Statistics"
              />
              <p class="title">Introduction to Mathematical Statistics</p>
              <p class="author">
                Robert V. Hogg, Joseph W. McKean, Allen T. Craig
              </p>
            </a>
            <a href="" class="book-wrapper">
              <img
                src="img/books/2.jpg"
                alt="Linear Algebra and Its Applications"
              />
              <p class="title">Linear Algebra and Its Applications</p>
              <p class="author">Gilbert Strang</p>
            </a>
            <a href="" class="book-wrapper">
              <img
                src="img/books/3.jpg"
                alt="Introduction to Mathematical Statistics"
              />
              <p class="title">Introduction to Mathematical Statistics</p>
              <p class="author">
                Robert V. Hogg, Joseph W. McKean, Allen T. Craig
              </p>
            </a>
            <a href="" class="book-wrapper">
              <img
                src="img/books/4.jpg"
                alt="Introduction to Mathematical Statistics"
              />
              <p class="title">Introduction to Mathematical Statistics</p>
              <p class="author">
                Robert V. Hogg, Joseph W. McKean, Allen T. Craig
              </p>
            </a>
            <a href="" class="book-wrapper">
              <img
                src="img/books/5.jpg"
                alt="Introduction to Mathematical Statistics"
              />
              <p class="title">Introduction to Mathematical Statistics</p>
              <p class="author">
                Robert V. Hogg, Joseph W. McKean, Allen T. Craig
              </p>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- footer -->
    <footer class="footer">
      <p>&copy; 2024 LeoScholar. All rights reserved.</p>
    </footer>

    <!-- JavaScript for toggling nav-links on mobile -->
    <script>
      document
        .querySelector(".menu-toggle")
        .addEventListener("click", function () {
          document.querySelector(".navbar").classList.toggle("active");
        });
    </script>

    <!-- Heart Icon -->
    <script>
      // Select the heart icon
      const heartIcon = document.querySelector(".heart-icon");

      // Toggle active class on click
      heartIcon.addEventListener("click", () => {
        heartIcon.classList.toggle("active"); // Add/remove red color
        heartIcon.classList.toggle("fas"); // Solid heart
        heartIcon.classList.toggle("far"); // Outline heart
      });
    </script>

    <!-- Script to display "Description" and "About the Author(s)" -->
    <script>
      // Function to handle truncating text
      function truncateText(element, lines, seeMoreElement) {
        const p = document.getElementById(element);
        const originalText = p.innerHTML.replace(/<br>/g, "\n"); // Preserve line breaks
        p.innerHTML = originalText; // Set original text
        const lineHeight = parseFloat(getComputedStyle(p).lineHeight); // Get line height

        // Set max-height based on the number of lines
        p.style.maxHeight = `${lines * lineHeight}px`;

        // Check if content exceeds the max-height
        if (p.scrollHeight > p.clientHeight) {
          seeMoreElement.style.display = "inline"; // Show "See More" link
        }
      }

      // Expand text function
      function expandText(element, seeMoreElement) {
        const p = document.getElementById(element);
        p.style.maxHeight = "none"; // Remove max height to show all text
        seeMoreElement.style.display = "none"; // Hide "See More" link
      }

      // Truncate both text sections (limit to 3 lines)
      truncateText(
        "description-text",
        3,
        document.getElementById("see-more-description")
      );
      truncateText(
        "author-description",
        3,
        document.getElementById("see-more-author")
      );

      // Event listeners for "See More" links
      document
        .getElementById("see-more-description")
        .addEventListener("click", function () {
          expandText("description-text", this);
        });

      document
        .getElementById("see-more-author")
        .addEventListener("click", function () {
          expandText("author-description", this);
        });

      // Replace \n with <br> for the author description text
      // const authorDescription = document.getElementById("author-description");
      // authorDescription.innerHTML = authorDescription.innerHTML.replace(
      //   /\n/g,
      //   "<br>"
      // );
    </script>

    <!-- Open PDF/Audio -->
    <script>
      function openPDF(path) {
        window.open(path, "_blank");
      }
    </script>

    <!-- Script for Loan form -->
    <script>
      // Show/hide form
      function toggleForm() {
        const loanForm = document.getElementById("loanForm");
        const loanReserveButton = document.getElementById("loanReserveButton");

        // Toggle form visibility
        if (
          loanForm.style.display === "none" ||
          loanForm.style.display === ""
        ) {
          loanForm.style.display = "block";
          loanReserveButton.innerText = "Close form"; // Change button text to "Close form"
        } else {
          loanForm.style.display = "none";
          loanReserveButton.innerText = "Loan/Reserve"; // Change button text back to "Loan/Reserve"
        }
      }

      // Validation for Date Fields
      function validateDates() {
        const fromDate = document.getElementById("from-date");
        const toDate = document.getElementById("to-date");
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Set time to midnight for accurate comparison

        const minFromDate = new Date(today);
        minFromDate.setDate(minFromDate.getDate() + 1); // From date must be at least 1 day from now

        // Check "From" date
        if (new Date(fromDate.value) < minFromDate) {
          fromDate.setCustomValidity(
            "From date must be at least 1 day from today."
          );
          fromDate.reportValidity();
        } else {
          fromDate.setCustomValidity("");
        }

        // Check "To" date
        if (fromDate.value) {
          // Ensure "From" date is valid before checking "To"
          const fromDateValue = new Date(fromDate.value);
          const maxEndDate = new Date(fromDateValue);
          maxEndDate.setDate(maxEndDate.getDate() + 14); // To date cannot exceed 14 days from "From" date

          if (new Date(toDate.value) < minFromDate) {
            toDate.setCustomValidity(
              "To date must be at least 1 day from today."
            );
            toDate.reportValidity();
          } else if (new Date(toDate.value) > maxEndDate) {
            toDate.setCustomValidity(
              "To date cannot exceed 14 days from the selected From date."
            );
            toDate.reportValidity();
          } else {
            toDate.setCustomValidity("");
          }
        }
      }

      // Update Availability Based on Branch
      function updateAvailability() {
        const branch = document.getElementById("branch").value;
        const availableCopiesField =
          document.getElementById("available-copies");
        const availabilityMessage = document.getElementById(
          "availability-message"
        );
        const actionButton = document.getElementById("actionButton");
        const fromDate = document.getElementById("from-date");
        const toDate = document.getElementById("to-date");

        // Sample data for available copies
        const availability = {
          ntu: 2,
          nus: 3,
          smu: 0,
        };

        // Display available copies based on selected branch
        const availableCopies = availability[branch] || 0;
        availableCopiesField.innerText = availableCopies;

        // Show "Loan" button or "Reserve" option based on availability
        if (availableCopies > 0) {
          availabilityMessage.innerText = "";
          actionButton.innerText = "Loan";
          actionButton.classList.remove("reserve");
          fromDate.disabled = false;
          toDate.disabled = false;
        } else {
          availabilityMessage.innerText =
            "This book is not available at your chosen branch. Please choose another branch or proceed to reserve it.";
          actionButton.innerText = "Reserve";
          actionButton.classList.add("reserve");
          fromDate.disabled = true;
          toDate.disabled = true;
        }
      }

      // Reset form
      function resetForm() {
        const availableCopiesField =
          document.getElementById("available-copies");
        availableCopiesField.innerText = "N/A";

        const availabilityMessage = document.getElementById(
          "availability-message"
        );
        availabilityMessage.innerText = "";
        actionButton.innerText = "Loan";
        actionButton.classList.remove("reserve");
      }

      // Form submission
      function submitForm() {
        const actionButton = document.getElementById("actionButton");
        alert(`${actionButton.innerText} request submitted.`);

        // Refresh the current page
        location.reload(); // This will refresh the page, closing the form
      }
    </script>

    <!-- Script to open "Availability" table -->
    <script>
      function toggleTable() {
        const availabilityTable = document.querySelector(".availability-table");
        const tableToggleButton = document.getElementById("tableToggleButton");

        // Toggle table visibility
        if (
          availabilityTable.style.display === "none" ||
          availabilityTable.style.display === ""
        ) {
          availabilityTable.style.display = "block";
          tableToggleButton.innerText = "Close table"; // Change button text to "Close table"
        } else {
          availabilityTable.style.display = "none";
          tableToggleButton.innerText = "More details"; // Change button text back to "Show table"
        }
      }
    </script>
  </body>
</html>
